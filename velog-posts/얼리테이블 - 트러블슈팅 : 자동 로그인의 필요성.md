<h2 id="1-ë¬¸ì œ">1. ë¬¸ì œ</h2>
<p>ì´ˆê¸°ì—ëŠ” ì—‘ì„¸ìŠ¤í† í°ë§Œì„ ì‚¬ìš©í•˜ì—¬ ë¡œê·¸ì¸ì„ ê´€ë¦¬í–ˆëŠ”ë°, ì—‘ì„¸ìŠ¤í† í°ì˜ ë§Œë£Œ ì‹œê°„ì´ ì§§ì•„ ì‚¬ìš©ìê°€ ìì£¼ ë¡œê·¸ì¸ì„ ë‹¤ì‹œ í•´ì•¼ í•˜ëŠ” ë¶ˆí¸í•¨ì´ ë°œìƒí–ˆìŠµë‹ˆë‹¤.</p>
<p>ì¦‰, ì‚¬ìš©ìê°€ ë¡œê·¸ì¸í•œ í›„ì—ë„ ì§§ì€ ì‹œê°„ë§ˆë‹¤ í† í° ë§Œë£Œë¡œ ì¸í•´ ì¸ì¦ì´ ëŠê¸°ê³ , ë‹¤ì‹œ ë¡œê·¸ì¸ì„ í•´ì•¼ í•˜ëŠ” ìƒí™©ì´ ë¬¸ì œì˜€ìŠµë‹ˆë‹¤.</p>
<hr />
<h2 id="2-ì›ì¸">2. ì›ì¸</h2>
<ul>
<li><p><strong>ì—‘ì„¸ìŠ¤í† í° ë§Œë£Œ ì‹œê°„</strong></p>
<p>  ì—‘ì„¸ìŠ¤í† í°ì€ ë³´í†µ ë³´ì•ˆìƒì˜ ì´ìœ ë¡œ ë§Œë£Œ ì‹œê°„ì´ ì§§ê²Œ ì„¤ì •ë©ë‹ˆë‹¤. ì´ë¡œ ì¸í•´, ì‚¬ìš©ìê°€ ì„œë¹„ìŠ¤ë¥¼ ì´ìš©í•˜ëŠ” ë„ì¤‘ì— í† í°ì´ ë§Œë£Œë˜ë©´ ì¸ì¦ ìƒíƒœê°€ í’€ë ¤ ë‹¤ì‹œ ë¡œê·¸ì¸ì„ ìš”êµ¬í•˜ê²Œ ë©ë‹ˆë‹¤.</p>
</li>
<li><p><strong>ì—‘ì„¸ìŠ¤í† í° ë‹¨ë… ê´€ë¦¬</strong></p>
<p>  ê¸°ì¡´ì—ëŠ” ì—‘ì„¸ìŠ¤í† í°ë§Œ ê´€ë¦¬í•˜ë‹¤ ë³´ë‹ˆ, í† í° ê°±ì‹  ë¡œì§ì´ ì—†ì–´ì„œ ë§Œë£Œë˜ë©´ ìƒˆ í† í°ì„ ë°œê¸‰ë°›ì§€ ëª»í•˜ê³  ë¡œê·¸ì¸ì´ ëŠê¸°ëŠ” ë¬¸ì œê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.</p>
</li>
</ul>
<hr />
<h2 id="3-í•´ê²°ì±…">3. í•´ê²°ì±…</h2>
<p>í•´ê²°ì±…ìœ¼ë¡œëŠ” <strong>ë¦¬í”„ë ˆì‰¬ í† í°(Refresh Token)</strong>ì„ ë„ì…í•˜ëŠ” ê²ƒì…ë‹ˆë‹¤.</p>
<ul>
<li><p><strong>ë¦¬í”„ë ˆì‰¬ í† í° ë°œê¸‰:</strong></p>
<p>  ì‚¬ìš©ìê°€ ë¡œê·¸ì¸í•  ë•Œ ì„œë²„ëŠ” ì—‘ì„¸ìŠ¤í† í°ê³¼ í•¨ê»˜ ë¦¬í”„ë ˆì‰¬ í† í°ì„ ë°œê¸‰í•©ë‹ˆë‹¤.</p>
</li>
<li><p><strong>ë¦¬í”„ë ˆì‰¬ í† í° ì €ì¥:</strong></p>
<p>  ë¦¬í”„ë ˆì‰¬ í† í°ì€ ë³´ì•ˆìƒì˜ ì´ìœ ë¡œ HttpOnly ì¿ í‚¤ë¡œ ì €ì¥í•©ë‹ˆë‹¤. ì´ ì¿ í‚¤ëŠ” JavaScriptì—ì„œ ì ‘ê·¼í•  ìˆ˜ ì—†ìœ¼ë¯€ë¡œ, XSS ê³µê²©ì— ì•ˆì „í•©ë‹ˆë‹¤.</p>
</li>
<li><p><strong>ì—‘ì„¸ìŠ¤í† í° ì €ì¥:</strong></p>
<p>  ì—‘ì„¸ìŠ¤í† í°ì€ ë¸Œë¼ìš°ì €ì˜ ë¡œì»¬ìŠ¤í† ë¦¬ì§€ì— ì €ì¥í•˜ì—¬ í´ë¼ì´ì–¸íŠ¸ ì¸¡ì—ì„œ ì‚¬ìš©í•©ë‹ˆë‹¤.</p>
</li>
<li><p><strong>ìë™ í† í° ê°±ì‹ :</strong></p>
<p>  í´ë¼ì´ì–¸íŠ¸ì—ì„œëŠ” ì—‘ì„¸ìŠ¤í† í°ì„ ì‚¬ìš©í•˜ë‹¤ê°€ ë§Œë£Œë˜ë©´, HttpOnly ì¿ í‚¤ì— ì €ì¥ëœ ë¦¬í”„ë ˆì‰¬ í† í°ì„ ì‚¬ìš©í•˜ì—¬ ì„œë²„ì— ìƒˆ ì—‘ì„¸ìŠ¤í† í° ë°œê¸‰ì„ ìš”ì²­í•©ë‹ˆë‹¤. ì´ ê³¼ì •ì€ axios ì¸í„°ì…‰í„° ë“±ì„ í†µí•´ ìë™ìœ¼ë¡œ ì²˜ë¦¬í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p>
</li>
</ul>
<hr />
<h2 id="4-ì ìš©-ì½”ë“œ-ì˜ˆì‹œ">4. ì ìš© (ì½”ë“œ ì˜ˆì‹œ)</h2>
<h3 id="41-ì„œë²„ì—ì„œ-refreshtoken-ì¶”ê°€-ë°œê¸‰">4.1. ì„œë²„ì—ì„œ RefreshToken ì¶”ê°€ ë°œê¸‰</h3>
<pre><code class="language-java">@PostMapping(&quot;/login&quot;)
    public ResponseEntity&lt;JwtAuthResponse&gt; loginUser(@Valid @RequestBody UserLoginRequestDto requestDto,
                                                     HttpServletResponse response) {

        String accessToken = userService.loginUser(requestDto);

                // ì¿ í‚¤ì— refresh token ë‹´ê¸°
        response.addCookie(userService.craeteCookie(requestDto.getEmail()));

        return ResponseEntity.status(HttpStatus.OK).body(new JwtAuthResponse(AuthenticationScheme.BEARER.getName(), accessToken));
    }</code></pre>
<ul>
<li>refresh Token ì„ ìƒì„±í•´ì„œ ì¿ í‚¤ì— ë‹´ëŠ” ë©”ì„œë“œ (UserService)</li>
</ul>
<pre><code class="language-java">/**
     * refresh Token ì„ ì¿ í‚¤ì— ë‹´ê¸°
     *
     * @return Cookie
     */
    public Cookie craeteCookie(String email) {

        String cookieName = &quot;refreshToken&quot;;
        String cookieValue = jwtProvider.generateRefreshToken(email); // ì¿ í‚¤ë²¨ë¥˜ì—” ê¸€ìì œí•œì´ ì´ì¨, ë²¨ë¥˜ë¡œ ë§Œë“¤ì–´ë‹´ì•„ì¤€ë‹¤.

        // refreshToken db ì €ì¥
        refreshTokenService.saveRefreshToken(email, cookieValue);

        Cookie cookie = new Cookie(cookieName, cookieValue);
        // ì¿ í‚¤ ì†ì„± ì„¤ì •
        cookie.setHttpOnly(true);  //httponly ì˜µì…˜ ì„¤ì •
        // cookie.setSecure(true); //https ì˜µì…˜ ì„¤ì •
        cookie.setPath(&quot;/&quot;); // ëª¨ë“  ê³³ì—ì„œ ì¿ í‚¤ì—´ëŒì´ ê°€ëŠ¥í•˜ë„ë¡ ì„¤ì •
        cookie.setMaxAge(60 * 60 * 24); //ì¿ í‚¤ ë§Œë£Œì‹œê°„ ì„¤ì •
        return cookie;

    }</code></pre>
<ul>
<li>Redisì— refresh Tokenì„ ì €ì¥ (ë§Œë£Œ ê¸°ê°„ 30ì¼)</li>
</ul>
<pre><code class="language-java">@Service
public class RefreshTokenService {

    private final RedissonClient redissonClient;

    public RefreshTokenService(RedissonClient redissonClient) {
        this.redissonClient = redissonClient;
    }

    // RefreshToken ì €ì¥
    public void saveRefreshToken(String username, String refreshToken) {
        RBucket&lt;String&gt; bucket = redissonClient.getBucket(&quot;refreshToken:&quot; + username);
        bucket.set(refreshToken, Duration.ofDays(30));
    }

    // RefreshToken ê°€ì ¸ì˜¤ê¸°
    public String getRefreshToken(String username) {
        RBucket&lt;String&gt; bucket = redissonClient.getBucket(&quot;refreshToken:&quot; + username);
        return bucket.get();
    }

    // RefreshToken ì‚­ì œ
    public void deleteRefreshToken(String username) {
        RBucket&lt;String&gt; bucket = redissonClient.getBucket(&quot;refreshToken:&quot; + username);
        bucket.delete();
    }

    // RefreshToken ê²€ì¦
    public boolean validateRefreshToken(String username, String refreshToken) {
        String storedToken = getRefreshToken(username);
        return storedToken != null &amp;&amp; storedToken.equals(refreshToken);
    }
}
</code></pre>
<h3 id="42-axios-ì¸í„°ì…‰í„°ë¥¼-í™œìš©í•œ-ìë™-í† í°-ê°±ì‹ ">4.2. Axios ì¸í„°ì…‰í„°ë¥¼ í™œìš©í•œ ìë™ í† í° ê°±ì‹ </h3>
<pre><code class="language-jsx">import axios from &quot;axios&quot;;

// ğŸ”¹ Axios ì¸ìŠ¤í„´ìŠ¤ ìƒì„±
const instance = axios.create({
  baseURL: &quot;http://localhost:8080&quot;, // Spring Boot ì„œë²„ ì£¼ì†Œ
  withCredentials: true, // ì¿ í‚¤ í¬í•¨ ìš”ì²­
});

// ğŸ”¹ ì•¡ì„¸ìŠ¤ í† í°ì„ ê°€ì ¸ì˜¤ëŠ” í•¨ìˆ˜
const getAccessToken = () =&gt; localStorage.getItem(&quot;accessToken&quot;);

// ğŸ”¹ ìš”ì²­ ì¸í„°ì…‰í„°: í—¤ë”ì— ì•¡ì„¸ìŠ¤ í† í° ì¶”ê°€
instance.interceptors.request.use(
  (config) =&gt; {
    const accessToken = getAccessToken();
    if (accessToken) {
      config.headers.Authorization = `Bearer ${accessToken}`;
    }
    return config;
  },
  (error) =&gt; Promise.reject(error)
);

// ğŸ”¹ ë¦¬í”„ë ˆì‹œ í† í°ì„ ì‚¬ìš©í•´ ìƒˆë¡œìš´ ì•¡ì„¸ìŠ¤ í† í°ì„ ê°€ì ¸ì˜¤ëŠ” í•¨ìˆ˜
const refreshAccessToken = async () =&gt; {
  try {
    const response = await instance.post(
      &quot;/users/refresh&quot;,
      {},
      {
        headers: { &quot;Content-Type&quot;: &quot;application/json&quot; },
        withCredentials: true, // HttpOnly ì¿ í‚¤ í¬í•¨
      }
    );

    const newAccessToken = response.data.accessToken;
    if (!newAccessToken) throw new Error(&quot;ìƒˆë¡œìš´ ì•¡ì„¸ìŠ¤ í† í° ì—†ìŒ&quot;);

    localStorage.setItem(&quot;accessToken&quot;, newAccessToken);
    return newAccessToken;
  } catch (error) {
    console.error(&quot;âŒ ë¦¬í”„ë ˆì‹œ í† í° ë§Œë£Œ: ë¡œê·¸ì¸ í˜ì´ì§€ë¡œ ì´ë™&quot;);
    localStorage.removeItem(&quot;accessToken&quot;);
    window.location.href = &quot;/login&quot;; // ë¡œê·¸ì¸ í˜ì´ì§€ë¡œ ë¦¬ë””ë ‰ì…˜
    return null;
  }
};

// ğŸ”¹ ì‘ë‹µ ì¸í„°ì…‰í„°: 401 ì‘ë‹µ ì²˜ë¦¬ (ì•¡ì„¸ìŠ¤ í† í° ê°±ì‹  í›„ ìš”ì²­ ì¬ì‹œë„)
instance.interceptors.response.use(
  (response) =&gt; response,
  async (error) =&gt; {
    const originalRequest = error.config;

    if (error.response?.status === 401 &amp;&amp; !originalRequest._retry) {
      originalRequest._retry = true; // ì¬ì‹œë„ ë°©ì§€ í”Œë˜ê·¸ ì„¤ì •

      const newAccessToken = await refreshAccessToken();
      if (newAccessToken) {
        originalRequest.headers.Authorization = `Bearer ${newAccessToken}`;
        return instance(originalRequest); // ìš”ì²­ ì¬ì‹œë„
      }
    }

    return Promise.reject(error);
  }
);

export default instance;
</code></pre>
<h3 id="43-ì„œë²„ì—ì„œ-ì—‘ì„¸ìŠ¤-í† í°-ì¬ë°œê¸‰-userservice">4.3 ì„œë²„ì—ì„œ ì—‘ì„¸ìŠ¤ í† í° ì¬ë°œê¸‰ (UserService)</h3>
<pre><code class="language-java">/**
     * refreshToken í™•ì¸ ë° accessToken ì¬ë°œê¸‰
     *
     * @param email
     * @return accessToken
     */
    public String refresh(String email, String refreshToken) {

        if(!refreshTokenService.validateRefreshToken(email, refreshToken)) {
            throw new UnauthorizedException(ErrorCode.UNAUTHORIZED);
        }

        return jwtProvider.generateAccessToken(email);
    }</code></pre>
<hr />
<h2 id="5-ìë™-ë¡œê·¸ì¸-í”Œë¡œìš°-ì„¤ëª…">5. ìë™ ë¡œê·¸ì¸ í”Œë¡œìš° ì„¤ëª…</h2>
<ol>
<li><strong>ë¡œê·¸ì¸ ì‹œ í† í° ë°œê¸‰</strong><ul>
<li>ì‚¬ìš©ìê°€ ë¡œê·¸ì¸í•˜ë©´ ì„œë²„ëŠ” ì—‘ì„¸ìŠ¤í† í°ê³¼ ë¦¬í”„ë ˆì‰¬ í† í°ì„ í•¨ê»˜ ë°œê¸‰í•©ë‹ˆë‹¤.</li>
<li>ì—‘ì„¸ìŠ¤í† í°ì€ ë¡œì»¬ìŠ¤í† ë¦¬ì§€ì— ì €ì¥ë˜ê³ , ë¦¬í”„ë ˆì‰¬ í† í°ì€ HttpOnly ì¿ í‚¤ì— ì €ì¥ë©ë‹ˆë‹¤.</li>
</ul>
</li>
<li><strong>ìš”ì²­ ì‹œ ì—‘ì„¸ìŠ¤í† í° ì‚¬ìš©</strong><ul>
<li>í´ë¼ì´ì–¸íŠ¸ëŠ” axios ì¸í„°ì…‰í„°ë¥¼ í†µí•´ ë¡œì»¬ìŠ¤í† ë¦¬ì§€ì˜ ì—‘ì„¸ìŠ¤í† í°ì„ HTTP í—¤ë”ì— í¬í•¨í•˜ì—¬ ìš”ì²­í•©ë‹ˆë‹¤.</li>
</ul>
</li>
<li><strong>ì—‘ì„¸ìŠ¤í† í° ë§Œë£Œ ì‹œ</strong><ul>
<li>ì„œë²„ë¡œë¶€í„° 401 Unauthorized ì‘ë‹µì„ ë°›ìœ¼ë©´ axios ì‘ë‹µ ì¸í„°ì…‰í„°ê°€ ë™ì‘í•©ë‹ˆë‹¤.</li>
</ul>
</li>
<li><strong>í† í° ê°±ì‹  ìš”ì²­</strong><ul>
<li>ì¸í„°ì…‰í„°ì—ì„œ <code>/users/refresh</code> APIë¥¼ í˜¸ì¶œí•˜ì—¬ ë¦¬í”„ë ˆì‰¬ í† í°ì„ ì‚¬ìš©í•´ ìƒˆ ì—‘ì„¸ìŠ¤í† í°ì„ ë°œê¸‰ë°›ìŠµë‹ˆë‹¤.</li>
</ul>
</li>
<li><strong>ìƒˆ í† í°ìœ¼ë¡œ ì¬ì‹œë„</strong><ul>
<li>ë°œê¸‰ë°›ì€ ìƒˆ ì—‘ì„¸ìŠ¤í† í°ì„ ë¡œì»¬ìŠ¤í† ë¦¬ì§€ì— ì €ì¥í•˜ê³ , ì›ë˜ì˜ ìš”ì²­ì„ ì¬ì‹œë„í•˜ì—¬ ìë™ ë¡œê·¸ì¸ì„ ìœ ì§€í•©ë‹ˆë‹¤.</li>
</ul>
</li>
<li><strong>ê°±ì‹  ì‹¤íŒ¨ ì‹œ</strong><ul>
<li>ìƒˆ í† í° ë°œê¸‰ì— ì‹¤íŒ¨í•˜ë©´ ì‚¬ìš©ìë¥¼ ë¡œê·¸ì¸ í˜ì´ì§€ë¡œ ë¦¬ë””ë ‰ì…˜í•˜ì—¬ ë‹¤ì‹œ ë¡œê·¸ì¸í•˜ë„ë¡ í•©ë‹ˆë‹¤.</li>
</ul>
</li>
</ol>
<hr />
<h2 id="ê²°ë¡ "><strong>ê²°ë¡ </strong></h2>
<p>ì—‘ì„¸ìŠ¤í† í°ì˜ ì§§ì€ ë§Œë£Œ ì‹œê°„ ë¬¸ì œë¥¼ í•´ê²°í•˜ê¸° ìœ„í•´ ë¦¬í”„ë ˆì‰¬ í† í°ì„ ë„ì…í•˜ì˜€ìŠµë‹ˆë‹¤.</p>
<p>ë¦¬í”„ë ˆì‰¬ í† í°ì€ HttpOnly ì¿ í‚¤ì— ì•ˆì „í•˜ê²Œ ì €ì¥ë˜ê³ , ì—‘ì„¸ìŠ¤í† í°ì€ ë¡œì»¬ìŠ¤í† ë¦¬ì§€ì— ì €ì¥ë˜ì–´ ì‚¬ìš©ë©ë‹ˆë‹¤.</p>
<p>axios ì¸í„°ì…‰í„°ë¥¼ í™œìš©í•´ 401 ì—ëŸ¬ ë°œìƒ ì‹œ ìë™ìœ¼ë¡œ ë¦¬í”„ë ˆì‰¬ í† í°ì„ ì‚¬ìš©í•´ ìƒˆ ì—‘ì„¸ìŠ¤í† í°ì„ ë°œê¸‰ë°›ì•„ ì›ë˜ì˜ ìš”ì²­ì„ ì¬ì‹œë„í•˜ë„ë¡ êµ¬í˜„í•˜ì—¬, ì‚¬ìš©ìê°€ ìì£¼ ë¡œê·¸ì¸í•  í•„ìš” ì—†ì´ ìë™ ë¡œê·¸ì¸ì´ ìœ ì§€ë˜ë„ë¡ í•´ê²°í–ˆìŠµë‹ˆë‹¤.</p>